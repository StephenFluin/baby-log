<div class="toolbar">
    <span>Baby Log</span>
    <div class="user-details">
        <img *ngIf="auth.state | async as state" class="user-img" [src]="state.photoURL">
        <button (click)="auth.logout()">Logout</button>
    </div>
</div>
<div style="height:5px;">
<progress *ngIf=" userData.status !== 'ready'" ></progress>
</div>
<ng-container *ngIf="(auth.state | async) as state; else: login">


    <div *ngIf="userData.eventList | async as events" class="main">
        <button class="button-standard button-icon-combo button-important" (click)="userData.createEvent()">
            <img src="../assets/images/baseline-add-24px.svg" height="20px" width="20px">
            <span>Create New Day</span>
        </button>

        <div *ngFor="let day of events; index as i" class="day-container">
            <h2>{{ day.value.date }}
                <img (click)="userData.deleteEvent(day.key)" src="../assets/images/baseline-delete_forever-24px.svg" height="24px" width="24px">
            </h2>

            <div class="highlight-box">
                <!-- <ngx-charts-pie-chart [legend]="true" [results]="(day.value | summarizeEvent)['sleepChart']"></ngx-charts-pie-chart> -->
                <p>
                    <span>Slept {{(day.value | summarizeEvent)['totalPretty']['asleep']}}</span><br>
                    <span></span>
                </p>
            </div>

            <div class="activity-buttons">
                <button class="activity-type" *ngFor="let type of userData.typeList | async" (click)="userData.addActivity(day.key, day.value, type.value.name ,'')">{{type.value.name}}</button>
            </div>
            <table style="max-width:500px;">
                <tr *ngFor="let activity of day.value.activities; index as activityIndex">
                    <td>
                        <input [ngxTimepicker]="picker"
                            [value]="activity.time.substring(11)"
                            readonly
                            style="width:80px;text-align:center;"
                        >
                        <ngx-material-timepicker
                            #picker
                            [theme]="darkTheme"
                            (timeSet)="userData.updateTime(
                                day.key,
                                day.value,
                                day.value.activities[activityIndex],
                                $event)"></ngx-material-timepicker>
                    </td>
                    <td>{{ activity.activity }}</td>
                    <td style="width:100%">
                        <div *ngIf="userData.typeList | async | typeMap as types">
                            <select style="width:100%" class="custom-select" *ngIf="types[activity.activity] && types[activity.activity].length; else raw"
                                (input)="activity.activityDetails = $event.target.value;userData.saveEvent(day.key, day.value)">
                                <option *ngFor="let option of types[activity.activity]" [selected]="option === activity.activityDetails">
                                    {{option}}
                                </option>
                                <option *ngIf="types[activity.activity] && types[activity.activity].indexOf(activity.activityDetails) === -1 && activity.activityDetails">{{activity.activityDetails}}</option>
                            </select>
                        </div>
                        <ng-template #raw>{{activity.activityDetails}}</ng-template>
                    </td>
                    <td>
                        <div class="icon-circle" (click)="userData.deleteActivity(day.key, day.value, i, activityIndex)">
                            <img src="../assets/images/baseline-delete_forever-24px.svg" height="20px" width="20px">
                        </div>
                    </td>
                </tr>
            </table>
        </div>

    </div>

    <app-manage-types></app-manage-types>

    <div class="main">
        <div style="margin-top:250px;">User {{state.uid}}</div>
        <h3>Join Family:</h3>
        <div class="flex">
            <input #familyId type="text">
            <button (click)="userData.join(state.uid, familyId.value)" class="button-standard">Join</button>
        </div>
    </div>


</ng-container>

<ng-template #login>
    <div class="main">
        <h1>Login to use the baby log</h1>
        <button (click)="auth.login()">Login</button>
    </div>
</ng-template>
